name: Build DouyinTV APK

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    container: cimg/android:2023.09

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Grant execute permission for gradlew
        run: chmod +x gradlew

      - name: Display Java version
        run: java -version

      - name: Display Gradle version
        run: cat gradle/wrapper/gradle-wrapper.properties | grep distributionUrl

      - name: Display Gradle wrapper JAR info
        run: ls -lh gradle/wrapper/gradle-wrapper.jar && file gradle/wrapper/gradle-wrapper.jar

      - name: Run gradle wrapper
        run: gradle wrapper --gradle-version 8.2 || gradle wrapper
        timeout-minutes: 10

      - name: Display Gradle info
        run: ./gradlew --version
        timeout-minutes: 5

      - name: Clean build
        run: ./gradlew clean
        timeout-minutes: 5

      - name: Build APK (Debug)
        run: ./gradlew assembleDebug --stacktrace --info
        timeout-minutes: 30
